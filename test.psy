== build ==
{
	add_link_library("Shell32.lib");
	add_source_directory("src");
	set_executable("stdtest");
	set_optimization(0);
}

mystruct ::= struct
{
	x : u64;
};

global_arena_val : arena mut;
global_arena : arena mut& mut;

print_path ::= func(path : u8& -> v0)
{
	putzstr(path);
	putchar(10);
};

main ::= func(-> s64)
{
	global_arena_val = arena_create(1024 * 1024);
	global_arena = ref global_arena_val;

	s ::= zero@mystruct mut;
	sptr ::= ref s;
	putuint(s.x);
	putchar(10);

	sptr->x = 5;

	putuint(s.x);
	putchar(10);

	putuint(sptr->x);
	putchar(10);

	mydata ::= u8[5]{'h';'e';'l';'l';'o';};

	mydata_str ::= sstr
	{
		.ptr := mydata at 0;
		.len := __sizeof(mydata);
	};

	putbytes(mydata_str.ptr, mydata_str.len);
	putchar(10);

	mydata_zstr : u8& mut;
	mydata_zstr = sstr2zstr(mydata_str, global_arena);

	putzstr(mydata_zstr);
	putchar(10);

	directory_iterate(".", print_path, global_arena);

	putzstr("log(2) == ");
	putfloat(log(0.8));
	putchar(10);
	return 0;
};
